
# HG changeset patch
# User Kai Engert <kaie@kuix.de>
# Date 1507823956 -7200
# Node ID 994e89150fc1cd0008d19a8ad8aafed565d98069
# Parent  f3766809817ba03aa8cc1da4fdf48bd011fc01e3
Bug 1403691, Change first NSS test cycle to explicitly use dbm file format, r=rrelyea

diff --git a/tests/all.sh b/tests/all.sh
--- a/tests/all.sh
+++ b/tests/all.sh
@@ -125,24 +125,30 @@ run_tests()
         echo "Running tests for ${TEST}"
         echo "TIMESTAMP ${TEST} BEGIN: `date`"
         (cd ${QADIR}/${TEST}; . ./${SCRIPTNAME} 2>&1)
         echo "TIMESTAMP ${TEST} END: `date`"
     done
 }
 
 ########################## run_cycle_standard ##########################
-# run test suites with defaults settings (no PKIX, no sharedb)
+# run test suites with dbm database (no PKIX, no sharedb)
 ########################################################################
 run_cycle_standard()
 {
     TEST_MODE=STANDARD
 
     TESTS="${ALL_TESTS}"
-    TESTS_SKIP=
+    TESTS_SKIP="cipher libpkix sdr ocsp pkits"
+
+    NSS_DEFAULT_DB_TYPE="dbm"
+    export NSS_DEFAULT_DB_TYPE
+
+    NSS_SSL_TESTS=`echo "${NSS_SSL_TESTS}" | sed -e "s/normal//g" -e "s/fips//g" -e "s/_//g"`
+    NSS_SSL_RUN=`echo "${NSS_SSL_RUN}" | sed -e "s/cov//g" -e "s/auth//g"`
 
     run_tests
 }
 
 ############################ run_cycle_pkix ############################
 # run test suites with PKIX enabled
 ########################################################################
 run_cycle_pkix()
@@ -157,17 +163,22 @@ run_cycle_pkix()
     mkdir -p "${HOSTDIR}"
     init_directories
 
     NSS_ENABLE_PKIX_VERIFY="1"
     export NSS_ENABLE_PKIX_VERIFY
 
     TESTS="${ALL_TESTS}"
     TESTS_SKIP="cipher dbtests sdr crmf smime merge multinit"
+
     NSS_SSL_TESTS=`echo "${NSS_SSL_TESTS}" | sed -e "s/normal//g" -e "s/fips//g" -e "s/_//g"`
+    export -n NSS_SSL_RUN
+
+    # use the default format
+    export -n NSS_DEFAULT_DB_TYPE
 
     run_tests
 }
 
 ######################### run_cycle_upgrade_db #########################
 # upgrades certificate database to shareable format and run test suites
 # with those databases
 ########################################################################
@@ -226,20 +237,20 @@ run_cycle_shared_db()
     mkdir -p "${HOSTDIR}"
     init_directories
 
     NSS_DEFAULT_DB_TYPE="sql"
     export NSS_DEFAULT_DB_TYPE
 
     # run the tests for native sharedb support
     TESTS="${ALL_TESTS}"
-    TESTS_SKIP="cipher libpkix dbupgrade sdr ocsp pkits"
+    TESTS_SKIP="dbupgrade"
 
-    NSS_SSL_TESTS=`echo "${NSS_SSL_TESTS}" | sed -e "s/normal//g" -e "s/fips//g" -e "s/_//g"`
-    NSS_SSL_RUN=`echo "${NSS_SSL_RUN}" | sed -e "s/cov//g" -e "s/auth//g"`
+    export -n NSS_SSL_TESTS
+    export -n NSS_SSL_RUN
 
     run_tests
 }
 
 ############################# run_cycles ###############################
 # run test cycles defined in CYCLES variable
 ########################################################################
 run_cycles()

